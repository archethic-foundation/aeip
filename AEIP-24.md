---
AEIP: 24
Title: Efficient Validation and Aggregation of Signatures in Archethic Transactions
Author: Akshay Kumar KANDHI MANJUNATHA REDDY <akshay@archethic.net>
Status: Draft
Type: Standards Track
Category: Core
Created: 2023-12-12
---

# Abstract

This AEIP proposes an enhancement to the Archethic blockchain's **Transaction Chains**, **Transaction Validation Process**, **Transaction / Data Verification** using Signature Aggregation Schemes. It addresses the storage and scalability issue related to transaction validation and transaction verification, particularly in the context of sharding where not all nodes store every transaction. The proposal introduces 
1. Aggregated cross-validation
2. Aggregated storage signatures

This will help to reduce the data footprint (instead of 200 signatures only 2 aggregated signatures will be needed) and also optimize network operations.

# Specification

## Problem Statement
Currently below is the Pending and the Validated Transactions 

![image](https://github.com/archethic-foundation/aeip/assets/75987671/9b69a945-f14b-44bb-b07c-d600a981dd26)
Where:  <br>
**@addr**: An unused address that corresponds to the hash of the public key of the transaction that will succeed it in the chain. <br>
**Type**: A type defining the functional role of the pending transaction.<br>
**Timestamp**: The date and time of the transaction generation.<br>
**DATA**: Data zone containing all the operations to be performed<br>
**Prev-PubKey**: The public key associated with the previous transaction<br>
**PrevKey Sig**: Signature from the private key associated with the mentioned public key to prove the possession of the private key.<br>
**OriginKey Sig**: Signature from the private key associated with the device or software from which the pending transaction was generated.<br>
**Validation Stamp**: The stamp generated by the elected coordinator node and containins<br>
**Cross Validation Stamp**: To be considered as valid, the Validation Stamp must be joined by as many Cross Validation Stamps.<br>
**Storage Node Attestations**: These attestations act as proof that the Storage Nodes have verified and stored the data.

The 2 problems with the current Transaction Chains are  <br>
**Problem 1- Storage Space**:
Every validated transaction in a transaction chain stores 200 signatures comprising of signatures of cross validation and storage nodes' attestation. Storing these 200 signatures for every transaction is not sustainable. <br>
**Problem 2- Fast Verficiation of Data on Archethic**:
In the current Archethic network, a node querying other nodes that store a transaction chain has no way to verify the authenticity of this retrieved data, inorder to verify the retrieved data, the node has to collect the 200 signatures corresponding to the transaction and verify individually. This process of verifying 200 individual signatures is highly time consuming. 

## Proposed Solution
The new proposed solution consists of two aggregated entities: (As shown below)
1. **Aggregated Cross Validation**: Combines 197 signatures from cross-validation nodes into a single entity.
2. **Aggregated Storage Signature**: Consolidates signatures from storage nodes into one.
  
 ![image](https://github.com/archethic-foundation/aeip/assets/75987671/6159d020-49be-4da7-9595-5f908274b1b1)

These aggregates will replace the extensive list of individual signatures, reducing the signature data by a factor of 200 and enabling faster verification. Hence they will contain <br>
**@addr**: An unused address that corresponds to the hash of the public key of the transaction that will succeed it in the chain. <br>
**Type**: A type defining the functional role of the pending transaction.<br>
**Timestamp**: The date and time of the transaction generation.<br>
**DATA**: Data zone containing all the operations to be performed<br>
**Prev-PubKey**: The public key associated with the previous transaction<br>
**PrevKey Sig**: Signature from the private key associated with the mentioned public key to prove the possession of the private key.<br>
**OriginKey Sig**: Signature from the private key associated with the device or software from which the pending transaction was generated.<br>
**Validation Stamp**: The stamp generated by the elected coordinator node and containins<br>
**Aggregated Cross Validation Stamp**: To be considered as valid, the Validation Stamp must be joined by as many Cross Validation Stamps.<br>
**Aggregated Storage Node Attestations**: These attestations act as proof that the Storage Nodes have verified and stored the data.

### Simple Solution Process

1. A transaction is sent to any node (welcome node).
2. The welcome node selects validation nodes and forwards the transaction for pre-validation.
3. Validation nodes retrieve necessary transactions for validation.
4. Cross-validation nodes rebuild the context and communicate with the coordinating node.
5. The coordinator node rebuilds the transaction context, completes the validation, and issues a validation stamp.
6. Cross-validation nodes verify the validation stamp and issue their own stamps.
7. Nodes begin the replication process and notify completion.
8. Aggregated signatures are computed and replace individual transaction signatures.

## Transaction Validation Process Diagram (Changes only in the last step: Step 8)

![image](https://github.com/archethic-foundation/aeip/assets/75987671/f76d6bff-17f2-42dc-a5c0-37b6d1e69e69) <br>
**Step 1:** Alice sends the transaction to any node in the network (welcome node) <br>
**Step 2:** The welcome node determines the validation nodes (coordinator and cross-validation) using Heuristic Algorithms, then forwards the transaction to the chosen nodes so that they can start the pre-validation work <br>
**Step 3:** The elected nodes (coordinators and cross validation nodes) get all the transactions necessary for validation from the closest storage nodes: the complete chain on the storage nodes of the transaction, and all transactions related to unspent entries (UTXO)... on the respective storage pools. (Prev Storage Nodes) <br>
**Step 4:** Once the context of the transaction has been rebuilt, the cross-validation nodes communicate to the coordinating node the list of storage nodes used to collect the data and their views on the availability of the validation and storage nodes. <br>
**Step 5:** The Coordinator node, later has to rebuild the context of the transaction (chain, inputs, output), figure out the proof of work (PoW), compute the replication tree , define the operations on the ledgers and sign the validation stamp and transmit it to the cross validation nodes. <br>
**Step 6:** The content of the Validation Stamp is verified by each cross-validation node which will further issue a "Cross-Validation Stamp" to the coordinator and other cross-validation nodes. <br>
**Step 7:** Once all the Cross-Validation Stamps are received by each validation node, they can start the replication process of the validated transaction, as defined by the Coordinator node: <br>
- Step 7a: the storage pool of the @Alice2 chain will recover the context of the transaction, if everything is compliant, store it in its local database and notify the validation and welcome nodes of the completeness of the replication.<br>
- Step 7b: The storage pools assigned to @Bob and the nodes involved will check the transaction’s compliance and integrate it into their db.<br>
- Step 7c: The storage pool related to the Beacon Chain will check the compliance of the transaction and integrate the timestamp and the addresses involved @Alice1, @Alice2, @Bob into the Beacon chain.<br>
- Step 7’: The Storage Nodes will send their respective storage node stamp to all the other nodes involved in the transaction.<br>

**Step 8:** The Storage Node along with Cross Validation and Coordinator node will calculate their respective aggregate signatures and replace the validated transaction signatures with the aggregated signatures. This is the final step of aggregating signatures and replacing the individual transaction signatures with these aggregated signatures is a method of compacting and finalizing the validation process, which is efficient and secure.<br>
- Step 8’: All the nodes verify the aggregated signatures.<br>

# Conclusion

The current transaction validation method in Archethic is not scalable and requires significant network resources. This proposal aims to streamline the process, ensuring robust security and efficiency. The proposed solution not only saves storage space but also accelerates the data verification process on the Archethic network, which is crucial for maintaining high throughput and scalability as the network grows. The proposed changes are backwards compatible as they enhance the validation process without altering the underlying transaction structure.

